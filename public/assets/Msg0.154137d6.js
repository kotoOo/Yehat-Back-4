import{r as e,c as t,z as s,A as o,f as a,o as i,g as n,j as r,E as m,q as c,t as l,l as d,D as u,F as p,x as f,v as g,G as k,P as y,C as v,J as h}from"./index.154289d4.js";import{_ as C}from"./stage2.41e6de3a.js";const x={props:{item:Object,noControls:Boolean,cha:Boolean,oneLine:Boolean},setup(s){const o=e=>{let t=""+e;for(;t.length<2;)t="0"+t;return t},a=e=>{let t=""+e;for(;t.length<3;)t="0"+t;return t};return{state:e({elapsed:t((()=>(e=>{const t=Math.floor(e/1e3),s=t%60,i=(t-s)/60,n=i%60,r=(i-n)/60;return[a(e%1e3),...[s,n,r].map(o)]})(s.item.timer.elapsedCom||0)))}),start:()=>{console.log("No action defined for starting this timer.")},restart:()=>{console.log("No action defined for restarting this timer.")},indexToRotation:e=>"...-'''-"[e]}}};s("data-v-05d2415c");const w={class:"timer"},_={class:"seconds q-mr-xs"},b=k("Start"),D=k("Pause"),j=k("Stop"),T=k("Resume"),z=k("Stop"),B=k("Restart");o();const S={components:{Timer0:C(x,[["render",function(e,t,s,o,k,y){const v=a("q-btn"),h=a("q-toolbar");return i(),n("div",w,[r("div",{class:l(["row items-end",{"no-wrap":s.oneLine,"justify-between":s.oneLine,"justify-center":!s.oneLine}]),style:c({whiteSpace:s.oneLine?"nowrap":null})},[r("div",_,m(o.state.elapsed[2])+" : "+m(o.state.elapsed[1]),1),r("div",{class:"ms",style:c({width:s.cha?"20px":null})},m(s.cha?o.indexToRotation(Math.floor(o.state.elapsed[0]/1e3*8)):o.state.elapsed[0]),5)],6),s.noControls?g("",!0):(i(),d(h,{key:0,dense:"",style:{"min-height":"20px"},class:"justify-center"},{default:u((()=>[0==s.item.timer.state?(i(),d(v,{key:0,onClick:o.start,dense:"",size:"12px",color:"amber-9"},{default:u((()=>[b])),_:1},8,["onClick"])):1==s.item.timer.state?(i(),n(p,{key:1},[f(v,{onClick:s.item.timer.pause,dense:"",size:"12px"},{default:u((()=>[D])),_:1},8,["onClick"]),f(v,{onClick:s.item.timer.stop,dense:"",size:"12px"},{default:u((()=>[j])),_:1},8,["onClick"])],64)):2==s.item.timer.state?(i(),n(p,{key:2},[f(v,{onClick:s.item.timer.resume,dense:"",size:"12px"},{default:u((()=>[T])),_:1},8,["onClick"]),f(v,{onClick:e.stop,dense:"",size:"12px"},{default:u((()=>[z])),_:1},8,["onClick"])],64)):3==s.item.timer.state?(i(),d(v,{key:3,onClick:o.restart,dense:"",size:"12px"},{default:u((()=>[B])),_:1},8,["onClick"])):g("",!0)])),_:1}))])}],["__scopeId","data-v-05d2415c"]])},props:{item:Object,edit:Boolean},setup(e,{emit:t}){const s=computed((()=>e.item.conn.from?ecs.root[e.item.conn.from].memberCard0.name:"guest"));let o=!1,a=!1;const i=async()=>{if(!e.item.conn.from)return void core.log(`${pure.itemToken(e.item)} No identity.`);if(o)return void(a=!0);o=!0;const{code:t,details:s,updates:n}=await yehat.ex({cmd:"msg0.compose",rel:e.item.conn.rel,messageBaseID:e.item.located.rel,memberCardID:e.item.conn.from,msg:e.item.msg0.msg});"ok"!==t?(core.log(`${pure.itemToken(e.item)} => msg0.compose => [Server] => [Error ${s}]`),o=!1):(o=!1,a&&(a=!1,i()))},n=[];onMounted((()=>{e.edit&&n.push(watch((()=>e.item.msg0.msg),(()=>{i()})))})),onBeforeUnmount((()=>{n.map((e=>e()))}));return{from:s,focus:()=>{e.item.timer&&0===e.item.timer.state&&(e.item.timer.start(),e.item.msg0vtm.dtStart=core.time())},done:()=>{(async()=>{if(!e.item.conn.from)return void core.log(`${pure.itemToken(e.item)} No identity.`);for(;a||o;)await core.ms(40);const{code:s,details:i}=await yehat.ex({cmd:"msg0.done",rel:e.item.conn.rel,messageBaseID:e.item.located.rel,memberCardID:e.item.conn.from});if("ok"!==s)return core.log(`${pure.itemToken(e.item)} => msg0.done => [Server] => [Error ${i}]`),void Quasar.Notify.create(i);t("done")})()},date:y}}};s("data-v-0ac4b0a9");const I=["id"],$={class:"row no-wrap"},L=r("div",{class:"avatar"},null,-1),M=r("div",{class:"flow col"},null,-1),N={key:0,class:"dt col-auto"},q={key:1,class:"col-auto"},R=k("Done"),Y={class:"from"},E=k("["),F={class:"name"},O=k("]:"),P={class:"msg-content"};o();var U=C(S,[["render",function(e,t,s,o,c,p){const k=a("Timer0"),y=a("btn0");return i(),n("div",{class:"msg-0",id:s.item.id},[r("header",$,[L,M,s.edit?g("",!0):(i(),n("div",N,m(o.date.formatDate(1e3*s.item.msg0vtm.dtCreated,"YYYY-MM-DD hh:mm")),1)),s.edit?(i(),n("div",q,[s.item.timer?(i(),d(k,{key:0,item:s.item,"no-controls":"",cha:"","one-line":"",class:"composing-timer"},null,8,["item"])):g("",!0),f(y,{tier:s.item.msg0.msg.trim().length?"standard":"proto",onClick:o.done},{default:u((()=>[R])),_:1},8,["tier","onClick"])])):g("",!0)]),s.edit?g("",!0):(i(),n("div",{key:0,class:l(["msg",{"msg-system":"system"===s.item.msg0.type}])},[r("span",Y,[E,r("span",F,m(o.from),1),O]),r("span",P,m(s.item.msg0.msg),1)],2)),s.edit?v((i(),n("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=e=>s.item.msg0.msg=e),class:"msg editor",onFocus:t[1]||(t[1]=(...e)=>o.focus&&o.focus(...e))},null,544)),[[h,s.item.msg0.msg]]):g("",!0)],8,I)}],["__scopeId","data-v-0ac4b0a9"]]);export{U as default};
