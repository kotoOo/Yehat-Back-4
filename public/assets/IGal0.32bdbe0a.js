import{f as e,l,D as a,o as t,j as i,E as s,x as d,g as o,k as n,G as r,v as m,q as c,F as u}from"./index.154289d4.js";import{_ as g}from"./stage2.41e6de3a.js";const{Notify:p}=Quasar;ecs.define("shhnSliderItem0",{ru:{caption:"",subcaption:""},en:{caption:"",subcaption:""},lastEventDate:""},{details:"Custom plug-in for Shining Hands index page slider."});const h={props:{item:Object},setup(e){const l=ref(null),a=ecs.singleton((l=>l.id==e.item.located.rel)),t=ecs.by((l=>l.image4&&l.located.rel==e.item.id)),i={en:{isIndexSlider:"Use as a slider at the Index page",sliderImageHeader:"Slide's Details",sliderImageCaption:"Slide caption",sliderImageSubcaption:"Slide subcaption",lastEventDate:"Last event date",save:"Save",imageSuccessfullySaved:"The slider component was successfully saved."},ru:{isIndexSlider:"Использовать для слайдера на главной странице",sliderImageHeader:"Настройки слайда",sliderImageCaption:"Заголовок",sliderImageSubcaption:"Подзаголовок",lastEventDate:"Дата последнего события",save:"Сохранить",imageSuccessfullySaved:"Поля для слайдер успешно сохранены."}},s=computed((()=>i[core.yehat.lang])),d=computed({get:()=>e.item.tags.has("index-slider"),set:l=>{l?(e.item.tags.add("index-slider"),t.value.forEach((e=>{e.shhnSliderItem0||(e.shhnSliderItem0=ecs.compo.shhnSliderItem0().shhnSliderItem0),e.saveLocal.shhnSliderItem0=!0,e.saveLocal.save()}))):(e.item.tags.remove("index-slider"),t.value.forEach((e=>{e.shhnSliderItem0&&delete e.shhnSliderItem0,delete e.saveLocal.shhnSliderItem0,e.saveLocal.save()}))),e.item.saveLocal.save()}});return{uploader:l,onAdded:async(t,i)=>{console.log("b",i);for(let d of t)try{let t=new FileReader,i=await new Promise(((e,l)=>{t.onload=()=>{e(t.result)},t.onerror=l,t.readAsDataURL(d)}));ecs.create("Image4",{image4:{originalFile:d.name,mimeType:d.type,lastModified:d.lastModified,fileSize:d.size,base64:i},located:{rel:e.item.id,pos:[0,0,0],size:[10,15]},connections:{gal:e.item.id,webapp:a.value.id,project:a.value.located.rel}}).saveLocal.save(),p.create("Image added."),l.value.reset()}catch(s){p.create({message:"Something goes wrong.",color:"negative"}),console.error(s),console.log("webapp",a)}},onRejected:(e,a)=>{l.value.reset(),p.create("Upload rejected, maybe wrong format."),console.log("onRejected",e,a)},images:t,i:s,isIndexSlider:d,lang:core.yehat.lang,saveImage:e=>{e.saveLocal.shhnSliderItem0=!0,e.saveLocal.save(),p.create(s.value.imageSuccessfullySaved)}}}},v=i("span",{class:"q-mr-xs"},"Gallery",-1),I=r(),f={class:"flow full-height column no-wrap"},S={class:"col"},b={class:"row full-height no-wrap"},y={class:"col-9 q-pa-sm"},w={class:"row scroll full-height q-gutter-md"},x={key:0,class:"column q-gutter-sm q-pl-sm"},V={class:"text-center font-weight-medium"},k={class:"col-3"},j={class:"q-mt-sm"},q={class:"col-auto"};var C=g(h,[["render",function(g,p,h,C,U,D){const L=e("BtnResize0"),E=e("BtnMove0"),R=e("q-input"),_=e("btn0"),A=e("q-toolbar"),z=e("IImage4"),F=e("ICard0"),H=e("q-uploader"),B=e("q-toggle"),M=e("q-btn"),N=e("IDialog0");return t(),l(N,{item:h.item,seamless:!1,"btn-close":"",tier:"proto"},{header:a((()=>[v,I,i("b",null,s(h.item.item.name||"- No Name -"),1)])),headerButtons:a((()=>[d(L,{item:h.item,dir:"w"},null,8,["item"]),d(L,{item:h.item,dir:"a"},null,8,["item"]),d(L,{item:h.item,dir:"s"},null,8,["item"]),d(L,{item:h.item,dir:"d"},null,8,["item"]),d(E,{item:h.item},null,8,["item"])])),default:a((()=>[i("div",f,[i("div",S,[i("div",b,[i("div",y,[i("div",w,[(t(!0),o(u,null,n(C.images,((e,n)=>(t(),l(F,{key:n,item:e,flowClasses:{"full-height":!0},bodyClasses:{"no-padding":!0},onClick:l=>e.dialog0.show=!0},{default:a((()=>[d(z,{item:e},{default:a((()=>[e.shhnSliderItem0?(t(),o("div",x,[i("header",V,s(C.i.sliderImageHeader),1),d(R,{modelValue:e.shhnSliderItem0[C.lang].caption,"onUpdate:modelValue":l=>e.shhnSliderItem0[C.lang].caption=l,label:C.i.sliderImageCaption,dark:"",filled:""},null,8,["modelValue","onUpdate:modelValue","label"]),d(R,{modelValue:e.shhnSliderItem0[C.lang].subcaption,"onUpdate:modelValue":l=>e.shhnSliderItem0[C.lang].subcaption=l,label:C.i.sliderImageSubcaption,dark:"",filled:""},null,8,["modelValue","onUpdate:modelValue","label"]),d(R,{modelValue:e.shhnSliderItem0.lastEventDate,"onUpdate:modelValue":l=>e.shhnSliderItem0.lastEventDate=l,label:C.i.lastEventDate,dark:"",filled:"",mask:"##.##.####"},null,8,["modelValue","onUpdate:modelValue","label"]),d(A,null,{default:a((()=>[d(_,{tier:"poormans",onClick:l=>C.saveImage(e)},{default:a((()=>[r(s(C.i.save),1)])),_:2},1032,["onClick"])])),_:2},1024)])):m("",!0)])),_:2},1032,["item"]),i("div",{class:"preview fit",style:c({background:`url(${e.image4.base64}) no-repeat center center / cover`})},null,4)])),_:2},1032,["item","onClick"])))),128))])]),i("div",k,[d(H,{class:"full-width",style:{"max-height":"100%",height:"240px"},url:`/api-raw/gallery/uploadImage/${h.item.id}`,label:"Upload Images",accept:".jpg, image/*",onRejected:C.onRejected,ref:"uploader",method:"POST","field-name":"image",onAdded:C.onAdded,"hide-upload-button":""},null,8,["url","onRejected","onAdded"]),i("div",j,[d(B,{modelValue:C.isIndexSlider,"onUpdate:modelValue":p[0]||(p[0]=e=>C.isIndexSlider=e),label:C.i.isIndexSlider},null,8,["modelValue","label"])])])])]),i("footer",q,[d(M,{fab:"",icon:"add",color:"accent",onClick:p[1]||(p[1]=e=>C.uploader.pickFiles(e)),style:{position:"absolute",right:"10px",bottom:"10px"}})])])])),_:1},8,["item"])}]]);export{C as default};
