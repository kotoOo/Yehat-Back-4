var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,l=(e,t)=>{for(var i in t||(t={}))r.call(t,i)&&a(e,i,t[i]);if(s)for(var i of s(t))o.call(t,i)&&a(e,i,t[i]);return e};"undefined"!=typeof require&&require;import{g as c,j as d,F as n,k as p,H as g,q as m,z as u,A as z,o as y,l as f,D as b,E as k,v,m as h,t as j}from"./index.154289d4.js";import{_ as x}from"./stage2.41e6de3a.js";Quasar;const P=(e,t)=>!(t[0]>=e[0]+e[2]||t[0]+t[2]<=e[0]||t[1]>=e[1]+e[3]||t[1]+t[3]<=e[1]);ecs.define("space1",{grid:[10,10,4,4],baseItemSize:[10,15],pixelPosition:e=>t=>[t[0]*(e.space1.grid[0]+e.space1.grid[2]),t[1]*(e.space1.grid[1]+e.space1.grid[3])],pixelSize:e=>t=>[t[0]*e.space1.grid[0]+(t[0]-1)*e.space1.grid[2],t[1]*e.space1.grid[1]+(t[1]-1)*e.space1.grid[3]],project:e=>([t,i])=>[Math.floor(t/(e.space1.grid[0]+e.space1.grid[2])),Math.floor(i/(e.space1.grid[1]+e.space1.grid[3]))]},{details:"Gridspace Configuration"});const S={props:{item:Object,proposedArrangement:Object,showProposedArrangement:Boolean,draggedItems:Object,handlers:Object},setup(e){const s=inject("table"),r=ref(null),o=computed((()=>(console.log("recomputing items"),Object.keys(e.item.grid0.roster).map((e=>ecs.root[e]))))),a=reactive({}),c=e=>!e||!Array.isArray(e)||e.length<2||0===e[0]||0===e[1],d=(e,t)=>e[0]>=t[0]&&e[1]>=t[1]&&e[0]+e[2]<=t[0]+t[2]&&e[1]+e[3]<=t[1]+t[3],n=computed((()=>l(l({position:"absolute"},core.style.transform(s.space1.pixelPosition(e.item.located.pos))),core.style.size(s.space1.pixelSize(e.item.located.size))))),p=computed((()=>{const t=[];for(let i=0;i<e.item.located.size[1];i++)for(let s=0;s<e.item.located.size[0];s++)t.push([s,i]);return t}));return{items:o,refs:a,theSpace:r,itemStyle:r=>{let o,a,c=!1;c=!!e.draggedItems[r.id],e.showProposedArrangement?o=[e.proposedArrangement[r.id][0]+e.item.located.pos[0],e.proposedArrangement[r.id][1]+e.item.located.pos[1]]:(a=e.item.grid0.roster[r.id].size,o=[e.item.grid0.roster[r.id].pos[0],e.item.grid0.roster[r.id].pos[1]]);const[d,n]=s.space1.pixelPosition(o),[p,g]=[d-s.camera.cx,n-s.camera.cy],[m,u]=s.space1.pixelSize(a);return z=l(l({position:"absolute"},core.style.transform([p,g])),core.style.size([m,u])),t(z,i({border:c?"1px solid yellow":null}));var z},draggedPatchStyle:t=>{const{id:i,space1:r,stage:a}=t,n=ecs.root[i],p=s.space1.project(r),g=[p[0]-e.item.located.pos[0],p[1]-e.item.located.pos[1]],m=s.space1.pixelPosition(g);let u,z;e.item.grid0.roster[i]?z=e.item.grid0.roster[i].size:(u=n.located?n.located.size:[10,15],z=c(u)?[10,15]:u);const y=d([...g,...z],[0,0,...e.item.located.size]);s.space1.pixelSize(z);let f=!1;for(let s of o.value){if(s.id===n.id)continue;let t=e.item.grid0.roster[s.id].size,i=e.item.grid0.roster[s.id].pos;P([...g,...z],[i[0],i[1],...t])&&(f=!0)}return l(l(l({},{position:"absolute",border:"1px dashed #111",background:f?"red":"green",display:y?"block":"none"}),core.style.size(s.space1.pixelSize(z))),core.style.transform([m[0],m[1]]))},spaceClick:()=>{console.log("Grid click.")},gridStyle:n,blocks:p,blockStyle:e=>{const[t,i]=s.space1.pixelPosition(e),[r,o]=[t-s.camera.cx,i-s.camera.cy];return l(l({},core.style.size([10,10])),core.style.transform([r,o]))},applyDrop:({record:t})=>{const{id:i,space1:r,stage:a}=t,l=ecs.root[i];let d;d=e.item.grid0.roster[i]?e.item.grid0.roster[i].size:l.located&&l.located.size?l.located.size:[10,15];const n=s.space1.project(r);console.log("Projected",n);const p=[n[0]-e.item.located.pos[0],n[1]-e.item.located.pos[1]];console.log("Relative",p),(([e,t,i,s],{id:r})=>{let a=!1;const l=[];for(let d of o.value){if(d.id===r)continue;let o=d.located?d.located.size:[10,15],n=c(o)?[10,15]:o,p=d.located?d.located.pos:[0,0];P([e,t,i,s],[p[0],p[1],...n])&&(a=!0,l.push(d))}return!!a&&l})([...p,...d],{id:i})?console.log("overlapping"):e.item.grid0.roster[i]={pos:p,size:d}},startResizing:t=>i=>{console.log("start resizing"),e.item.grid0.roster[t].resizing=!0,e.item.grid0.roster[t].resizingDelta=[0,0],e.item.grid0.roster[t].resizingPage=[i.pageX,i.pageY],e.item.grid0.roster[t].resizingInitial=[...e.item.grid0.roster[t].size]},mouseMove:t=>{for(let i in e.item.grid0.roster){let s=e.item.grid0.roster[i];if(!s.resizing)continue;let r=[t.pageX-s.resizingPage[0],t.pageY-s.resizingPage[1]];s.resizingDelta[0]=r[0],s.resizingDelta[1]=r[1];let o=[s.resizingInitial[0]+Math.floor(s.resizingDelta[0]/10),s.resizingInitial[1]+Math.floor(s.resizingDelta[1]/10)];o[0]<1||o[1]<1||d([s.pos[0],s.pos[1],...o],[0,0,e.item.located.size[0],e.item.located.size[1]])&&(s.size=o)}},mouseUp:t=>{Object.values(e.item.grid0.roster).map((e=>e.resizing=!1))},itemClick:(t,i)=>{console.log("[Grid0]ItemClick",t,i);const s=e.item.grid0.selected.indexOf(t.id);~s?e.item.grid0.selected.splice(s,1):e.item.grid0.selected.push(t.id)},table:s}}};u("data-v-1cbc5074");const O={class:"blocks"},w=["onMousedown"],C={key:0,class:"size"},I={key:1};z();var D=x(S,[["render",function(e,t,i,s,r,o){return s.table?(y(),c("div",{key:0,class:"grid0 space col",ref:"theSpace",onClick:t[0]||(t[0]=g(((...e)=>s.spaceClick&&s.spaceClick(...e)),["stop"])),style:m(s.gridStyle)},[d("div",O,[(y(!0),c(n,null,p(s.blocks,((e,t)=>(y(),c("div",{key:t,style:m(s.blockStyle(e)),class:"block"},null,4)))),128))]),(y(!0),c(n,null,p(s.items,((e,t)=>(y(),f(h("div"),{key:e.id,style:m(s.itemStyle(e)),item:e,onClick:g((t=>s.itemClick(e,t)),["stop"]),class:j(["z5-item",{"z5-item-selected":!!~i.item.grid0.selected.indexOf(e.id)}]),ref:t=>s.refs[e.id]=t,onMousedown:g((t=>i.handlers.mouseDown(e,t)),["stop"]),onTouchstart:g((t=>i.handlers.touchstart(e,t)),["stop"])},{default:b((()=>[d("div",{onMousedown:g((t=>s.startResizing(e.id)(t)),["stop"]),class:"resizer"},null,40,w),i.item.grid0.roster[e.id].resizing?(y(),c("div",C," Size: "+k(i.item.grid0.roster[e.id].size),1)):v("",!0),e.item.gridComponent?(y(),f(h(e.item.gridComponent),{key:1,item:e},null,8,["item"])):v("",!0)])),_:2},1032,["style","item","onClick","class","onMousedown","onTouchstart"])))),128)),(y(!0),c(n,null,p(i.draggedItems,((e,t)=>(y(),c("div",{key:"patch"+t,style:m(s.draggedPatchStyle(e)),class:"z5-dragged-item"},null,4)))),128))],4)):(y(),c("div",I,"GRID0"))}],["__scopeId","data-v-1cbc5074"]]);export{D as default};
