var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,c=(e,t)=>{for(var o in t||(t={}))n.call(t,o)&&s(e,o,t[o]);if(i)for(var o of i(t))r.call(t,o)&&s(e,o,t[o]);return e};"undefined"!=typeof require&&require;import{f as a,l as d,D as l,H as m,a as u,I as p,z as g,A as f,o as v,G as y,E as k,C as S,J as w,j as C,x as q}from"./index.154289d4.js";import{_ as h}from"./stage2.41e6de3a.js";const O={props:{item:Object},setup(e){core.log("${pure.itemToken(props.item)} item",e.item);const i={thrownException:null,consoleCapture:[],output:void 0,dtStart:0,dtCompiled:0,dtFinished:0,dtException:0},n=reactive(c({ta:null,showDia0:!1,dia0Out:"",dia0OutRef:null,dia0PreviewStack:!1,isDirty:!1},i)),r=computed({get:()=>e.item.code1.code,set:t=>{e.item.code1.code=t,s()}}),s=()=>{const t=JSON.parse(localStorage[`${ecs.prefix}-${e.item.id}`]||"{}");return(t.code1?t.code1.code:"")===e.item.code1.code?(n.isDirty=!1,!1):(n.isDirty=!0,!0)},a=e=>{const t=e.selectionStart,o=e.selectionEnd,i=e.selectionDirection;return t===o?t:"forward"===i?o:t},d=computed({get:()=>[0,0],set:e=>core.log("selection!!",e)}),l=computed((()=>pure.itemToken(e.item))),m=computed((()=>{const t=ecs.root.YykawqvDqjBOYcKCw4VmQS;if(!t.drNorton0.theActivePanel.selection||"mid"===t.drNorton0.activePanel)return!1;return!!~t.drNorton0.theActivePanel.selection.indexOf(e.item.id)}));onMounted((()=>{s()}));const g=ecs.by((t=>t.located&&t.located.rel===e.item.id)),f=async()=>{const t=e.item.code1seq.stack,o=t.map(((e,t)=>{const o=n.dia0PreviewStack?`<pre>${ecs.root[e].code1.code}</pre>`:"";return`<div class="row no-wrap items-center">\n          <div class="col">${t}: ${pure.itemTokenExt0(ecs.root[e])}</div>\n          <div class="col-auto">\n            <btn0 tier="poormans" @click="toStock('${e}')">Drop</btn0>\n          </div>\n        </div>${o}`})),i=ecs.find((o=>o.located&&o.located.rel===e.item.id&&!~t.indexOf(o.id))).map((e=>({id:e.id,token:pure.itemTokenExt0(e)}))).map((e=>{const t=n.dia0PreviewStack?`<pre>${ecs.root[e.id].code1.code}</pre>`:"";return`<div class="row no-wrap items-center">\n          <div class="col">${e.token}</div>\n          <div class="col-auto">\n            <btn0 tier="standard" @click="toStack('${e.id}')">PUSH</btn0>\n          </div>\n        </div>${t}`})),r=`\n        <header class="row no-wrap items-center">\n          <div class="col">STACK</div>\n          <div class="col-auto">\n            <btn0 tier="${n.dia0PreviewStack?"premium":"poormans"}" @click="togglePreview">PREVIEW</btn0>\n          </div>\n        </header>\n        ${o.join("")||"[Empty]"}<header>stock</header>${i.join("")}`;let s=null;const c=u({template:r,setup:()=>({toStack:t=>{e.item.code1seq.stack.push(t),s.unmount(),f()},toStock:t=>{const o=e.item.code1seq.stack.indexOf(t);~o&&e.item.code1seq.stack.splice(o,1),s.unmount(),f()},togglePreview:()=>{n.dia0PreviewStack=!n.dia0PreviewStack,s.unmount(),f()}})});for(s=p(c),Object.entries(core.appComponents).map((([e,t])=>s.component(e,t))),n.showDia0=!0;!n.dia0OutRef;)await core.ms(50);s.mount(n.dia0OutRef)},v=(...e)=>(n.consoleCapture.push(e.reduce(((e,t)=>e+" "+pure.safeStringify(t)),"")),core.log(...e)),y=n.exceptionTime?`[ Exception time ]:  ${n.exceptionTime-n.dtStart} ms`:"",k=computed((()=>`\n      [ Output ]: ${n.output}\n      [ Type ]: ${typeof n.output}\n      [ Compilation time ]:  ${n.dtCompiled-n.dtStart} ms\n      [ Execution time ]:  ${n.dtFinished-n.dtCompiled} \n      \n---[ Captured console output ]--------------------------------------------------\n${n.consoleCapture}\n      Thrown exception: ${n.thrownException}\n    `));return{state:n,keyup:t=>{n.ta&&(e.item.code1.cursor=a(n.ta))},keydown:t=>{if("Tab"===t.code){if(n.ta){core.log(`${pure.itemToken(e.item)} state.ta`,n.ta);const{selectionStart:o,selectionEnd:i}=n.ta,s=e.item.code1.indexToCR(o),c=e.item.code1.indexToCR(i);core.log(`${pure.itemToken(e.item)} cr0`,s,"cr1",c),Math.abs(s[1]-c[1]);const a=e.item.code1.code.split("\n"),d=a.slice(0,s[1]),l=a.slice(c[1]+1),m=t.shiftKey?e=>" "===e[0]&&" "===e[1]?e.slice(2):e:e=>`  ${e}`,u=[...d,...a.slice(s[1],c[1]+1).map(m),...l];r.value=u.join("\n");const p=[d.join("\n").length,e.item.code1.code.length-l.join("\n").length];core.log(`${pure.itemToken(e.item)} newSelection`,p),nextTick((()=>{n.ta.setSelectionRange(p[0]+1,p[1]-1)}))}return t.preventDefault(),void t.stopPropagation()}},save:()=>{e.item.saveLocal.save(),Quasar.Notify.create("Saved."),s()},selection:d,goPrev:()=>{if(e.item.code1seq)if(e.item.code1seq.prev){const t=ecs.root[e.item.code1seq.prev];t.dialog0.show=!0;const o=ecs.root[e.item.grid0user.gridID];o.grid0.deploy(t),console.log("my pos before manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos before manage",JSON.stringify(o.grid0.roster[t.id],null,2)),o.grid0.manage({id:t.id,nextTo:e.item.id,dir:"w"}),o.grid0.manage({id:t.id,column:"YykawqvDqjBOYcKCw4VmQS"}),console.log("my pos after manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos after manage",JSON.stringify(o.grid0.roster[t.id],null,2))}else{const t=ecs.create("Code1",{located:{rel:e.item.located.rel},dialog0:{show:!0},code1seq:{prev:null,next:e.item.id,isStart:!0,isEnd:!1}}),o=ecs.root[e.item.grid0user.gridID];o.grid0.deploy(t),console.log("my pos before manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos before manage",JSON.stringify(o.grid0.roster[t.id],null,2)),o.grid0.manage({id:t.id,nextTo:e.item.id,dir:"w"}),o.grid0.manage({id:t.id,column:"YykawqvDqjBOYcKCw4VmQS"}),console.log("my pos after manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos after manage",JSON.stringify(o.grid0.roster[t.id],null,2)),e.item.code1seq.prev=t.id,e.item.code1seq.isStart=!1,e.item.saveLocal.save(),t.saveLocal.save()}},goNext:()=>{if(e.item.code1seq)if(e.item.code1seq.next){const t=ecs.root[e.item.code1seq.next];t.dialog0.show=!0;const o=ecs.root[e.item.grid0user.gridID];o.grid0.deploy(t),console.log("my pos before manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos before manage",JSON.stringify(o.grid0.roster[t.id],null,2)),o.grid0.manage({id:t.id,nextTo:e.item.id,dir:"s"}),o.grid0.manage({id:t.id,column:"YykawqvDqjBOYcKCw4VmQS"}),console.log("my pos after manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos after manage",JSON.stringify(o.grid0.roster[t.id],null,2))}else{const t=ecs.create("Code1",{located:{rel:e.item.located.rel},dialog0:{show:!0},code1seq:{prev:e.item.id,next:null,isStart:!1,isEnd:!0}}),o=ecs.root[e.item.grid0user.gridID];o.grid0.deploy(t),console.log("my pos before manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos before manage",JSON.stringify(o.grid0.roster[t.id],null,2)),o.grid0.manage({id:t.id,nextTo:e.item.id,dir:"s"}),o.grid0.manage({id:t.id,column:"YykawqvDqjBOYcKCw4VmQS"}),console.log("my pos after manage",JSON.stringify(o.grid0.roster[e.item.id],null,2)),console.log("delegate pos after manage",JSON.stringify(o.grid0.roster[t.id],null,2)),e.item.code1seq.next=t.id,e.item.code1seq.isEnd=!1,e.item.saveLocal.save(),t.saveLocal.save()}},token:l,onFocus:()=>{ecs.root[e.item.grid0user.gridID].grid0.manage({id:e.item.id,column:"YykawqvDqjBOYcKCw4VmQS"})},click:t=>{n.ta&&(e.item.code1.cursor=a(n.ta))},toggleSelect:()=>{const t=ecs.root.YykawqvDqjBOYcKCw4VmQS;if(!t.drNorton0.theActivePanel.selection||"mid"===t.drNorton0.activePanel)return;const o=t.drNorton0.theActivePanel.selection.indexOf(e.item.id);~o?t.drNorton0.theActivePanel.selection.splice(o,1):t.drNorton0.theActivePanel.selection.push(e.item.id)},isSelected:m,eatSelected:()=>{const t=ecs.root.YykawqvDqjBOYcKCw4VmQS;if(!t.drNorton0.theActivePanel.selection||"mid"===t.drNorton0.activePanel)return!1;let o=0,i=null;for(let n of t.drNorton0.theActivePanel.selection){let t=ecs.root[n];if(t.code1seq){let e=t.code1seq.prev;e&&(ecs.root[e].code1seq.next=t.code1seq.next,ecs.root[e].code1seq.isEnd=null===ecs.root[e].code1seq.next),t.code1seq.prev=i;let o=t.code1seq.next;o&&(ecs.root[o].prev=e),t.code1seq.next=null,t.code1seq.isStart=null===e,t.code1seq.isEnd=!0}t.located.rel=e.item.id,ecs.root[n].saveLocal.save(),o++,i=n}core.log(`${pure.itemToken(e.item)} eatSelection successfull, items moved: ${o} `,t.drNorton0.theActivePanel.selection),t.drNorton0.theActivePanel.selection=[]},code:r,items:g,openInner:f,run:()=>{Object.assign(n,i);const r=+new Date;let s,a=0,d=0;try{const i=new Function("core",e.item.code1.code);a=+new Date,s=i((l=c({},core),t(l,o({log:v})))),d=+new Date,Object.assign(n,{output:s,dtStart:r,dtCompiled:a,dtFinished:d}),Quasar.Notify.create("Result: "+s)}catch(u){Quasar.Notify.create("Error:"+u.message),Object.assign(n,{thrownException:u,dtException:+new Date}),console.error(u)}var l;const m=ecs.root.YykawqvDqjBOYcKCw4VmQS;return"mid"===m.drNorton0.activePanel?(core.log(`${pure.itemToken(e.item)}: [DRNorton0 YykawqvDqjBOYcKCw4VmQS] is showing MID panel => output to log only.`),core.log(`${pure.itemToken(e.item)}>[+]>`),core.log(k.value),s):(m.drNorton0.theActivePanel.mode="output",m.cmdLine0.buffer.push({type:"command",caption:`${pure.itemToken(e.item)}<[run]`}),m.cmdLine0.buffer.push({type:"result",caption:n.output}),m.cmdLine0.buffer.push({type:"result",caption:`${pure.itemToken(e.item)}>[+ OutputType0] ${typeof n.output}\n${pure.itemToken(e.item)}>[+ CompilationTime0] ${n.dtCompiled-n.dtStart} ms\n${pure.itemToken(e.item)}>[+ ExecutionTime0]  ${n.dtFinished-n.dtCompiled} ms\n      \n${pure.itemToken(e.item)}>[+ CapturedConsoleOutput0]\n${n.consoleCapture}\n${pure.itemToken(e.item)}>[+ ThrownException0]${n.thrownException}\n    `}),s)},slug:()=>Quasar.copyToClipboard(core.slug()).then((e=>Quasar.Notify.create("Slug Generated."))),exceptionTime:y,outputString:k,dialog0Click:()=>{ecs.find((t=>t.attention0&&t.id!==e.item.id)).map((e=>e.attention0.present=!1)),e.item.attention0.present=!0}}}};g("data-v-0d95cad1");const x={class:"column full-height no-wrap"},N={class:"col"},$={class:"col-auto buttons row q-gutter-x-xs"},b=y("Prev"),D=y("Next"),T=y("Run"),P=y("Compile"),j=y("Select in DRNorton0"),E=y("Eat Selected ()"),Y=y("Dialog"),J=y("SLUG"),R=C("div",{class:"col-auto"},[C("div",{class:"small-caption"},"Cursor")],-1),I={class:"col-auto"};f();var Q=h(O,[["render",function(e,t,o,i,n,r){const s=a("Fav0"),c=a("BtnResize0"),u=a("BtnMove0"),p=a("btn0"),g=a("IDialog0");return v(),d(g,{item:o.item,"btn-close":"",itemless:"",onClick:m(i.dialog0Click,["stop"])},{header:l((()=>[y(" [Code0] "+k(o.item.code1seq.isStart?"[START]":"")+" "+k(o.item.code1seq.isEnd?"[END]":"")+" ",1),S(C("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.item.code1.name=e),class:"name"},null,512),[[w,o.item.code1.name]])])),headerButtons:l((()=>[q(s,{item:o.item},null,8,["item"]),q(c,{item:o.item,dir:"w"},null,8,["item"]),q(c,{item:o.item,dir:"a"},null,8,["item"]),q(c,{item:o.item,dir:"s"},null,8,["item"]),q(c,{item:o.item,dir:"d"},null,8,["item"]),q(u,{item:o.item},null,8,["item"])])),default:l((()=>[C("div",x,[C("div",N,[S(C("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.code=e),autofocus:"",class:"editor fit",resize:"none",type:"code",onKeydown:t[2]||(t[2]=(...e)=>i.keydown&&i.keydown(...e)),ref:e=>i.state.ta=e,onKeyup:t[3]||(t[3]=(...e)=>i.keyup&&i.keyup(...e)),onFocus:t[4]||(t[4]=(...e)=>i.onFocus&&i.onFocus(...e)),onClickPassive:t[5]||(t[5]=(...e)=>i.click&&i.click(...e))},null,544),[[w,i.code]])]),C("div",$,[q(p,{tier:o.item.code1seq.isStart?"premium":"standard",onClick:i.goPrev},{default:l((()=>[b])),_:1},8,["tier","onClick"]),q(p,{tier:o.item.code1seq.isEnd?"premium":"standard",onClick:i.goNext},{default:l((()=>[D])),_:1},8,["tier","onClick"]),q(p,{tier:i.state.isDirty?"epic":"standard",onClick:i.save},{default:l((()=>[y(k(i.state.isDirty?"Save":"Saved"),1)])),_:1},8,["tier","onClick"]),q(p,{tier:"monkeys",onClick:i.run},{default:l((()=>[T])),_:1},8,["onClick"]),q(p,{tier:"proto"},{default:l((()=>[P])),_:1}),q(p,{tier:i.isSelected?"premium":"proto",onClick:i.toggleSelect},{default:l((()=>[j])),_:1},8,["tier","onClick"]),q(p,{tier:"monkeys",onClick:i.eatSelected},{default:l((()=>[E])),_:1},8,["onClick"]),q(p,{tier:"monkeys",onClick:t[6]||(t[6]=e=>i.state.showDia0=!0)},{default:l((()=>[Y])),_:1}),q(p,{tier:i.items.length?"premium":"proto",onClick:i.openInner},{default:l((()=>[y("Inside "+k(i.items.length),1)])),_:1},8,["tier","onClick"]),q(p,{onClick:i.slug,tier:"standard"},{default:l((()=>[J])),_:1},8,["onClick"]),R,C("div",I," Idx "+k(o.item.code1.cursor)+" CR ["+k(o.item.code1.currentCR[0])+", "+k(o.item.code1.currentCR[1])+"] ",1)])])])),_:1},8,["item","onClick"])}],["__scopeId","data-v-0d95cad1"]]);export{Q as default};
