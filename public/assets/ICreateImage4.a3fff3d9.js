var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,r=(e,r)=>{for(var c in r||(r={}))t.call(r,c)&&i(e,c,r[c]);if(a)for(var c of a(r))o.call(r,c)&&i(e,c,r[c]);return e};"undefined"!=typeof require&&require;import{f as c,B as s,l as n,D as l,o as m,G as d,E as p,j as u,q as g,g as v,v as f,x as y,C}from"./index.154289d4.js";import{_ as b}from"./stage2.41e6de3a.js";const{Notify:I}=Quasar,h={props:{item:Object},setup(e){const a=reactive({image:null,canvas:null,imageSize:computed((()=>{const{image:e}=a;return e?[e.width,e.height]:[0,0]})),processPickerTitle:computed((()=>a.processID?ecs.root[a.processID].code1.name||ecs.root[a.processID].code1.code.slice(0,32)||"[Code1 Empty]":"- Pick Process -"))}),t=computed((()=>{const e=a.imageSize;if(e[0]>576||e[1]>320){const a=e[0]/576,t=e[1]/320,o=a>t?a:t,i=[Math.floor(e[0]/o),Math.floor(e[1]/o)];return r({},core.style.size(i))}return r({},core.style.size(e))})),o=computed((()=>{})),i=computed((()=>ecs.root.EHfCusKyw5k8TMKbwojCk8?ecs.root.EHfCusKyw5k8TMKbwojCk8.connections.at:null)),c=computed((()=>{const e=ecs.findOne((e=>"DRNorton0"===e.type));return e?"mid"===e.drNorton0.activePanel?null:e.drNorton0.theActivePanel.at:null})),s=computed((()=>[{value:null,label:e.item.i.chooseTarget},...c.value?[{value:c.value,label:`DRNorton -- ${pure.itemToken(ecs.root[c.value])}`}]:[],...o.value?[{value:o.value,label:e.item.i.yourInventory}]:[],...i.value?[{value:i.value,label:e.item.i.ziiTable5}]:[]]));let n=[];onMounted((()=>{e.item.slapTarget0.roster.draw=({source:t,payload:o=null})=>{console.log("Slap0 Handler Source: ",t," payload(ignored)",o);const i=new Image;i.onload=async()=>{if(a.image=i,console.log("image",i),a.canvas){a.canvas.width=i.width,a.canvas.height=i.height;a.canvas.getContext("2d").drawImage(i,0,0)}},i.onerror=e=>I.create(`Error loading image. ${e.message}`),i.src=e.item.diaCreateImage4.incoming}})),onBeforeUnmount((()=>n.map((e=>e()))));const l=computed((()=>e.item.diaCreateImage4.incoming?pure.humanStorageSize(e.item.diaCreateImage4.incoming.length):"NULL"));return{targetOptions:s,doCreate:async()=>{if(I.create(`Create in: ${e.item.diaCreateImage4.target}. In progress...`),!e.item.diaCreateImage4.target)return void I.create("Unsertain where to create...");const t=ecs.root[e.item.diaCreateImage4.target];let o={};t.page0?(o.page=t.id,o.webapp=t.connections.webapp,o.project=t.connections.project):t.gal0?(o.gal=t.id,o.webapp=t.connections.webapp,o.project=t.connections.project):t.webapp0?(o.webapp=t.id,o.project=t.connections.project):"Project"===t.type&&(o.project=t.id);ecs.create("Image4",{image4:{originalFile:"",base64:e.item.diaCreateImage4.incoming,lastModified:+new Date,mimeType:null,fileSize:e.item.diaCreateImage4.incoming.length,size:[...a.imageSize]},connections:o,located:{rel:t.id,pos:[0,0],size:[10,15]}}).saveLocal.save(),I.create("Created and saved locally.")},i:e.item.i,state:a,canvasStyle:t,pickProcess:e=>{a.processID=e},process:()=>{if(!a.processID)return void Quasar.Notify.create("Pick a process...");const t=ecs.root[a.processID].code1.code,o=new Function("base64","size",t);try{const t=o(e.item.diaCreateImage4.incoming,a.imageSize);"string"==typeof t?Quasar.copyToClipboard(t).then((()=>{Quasar.Notify.create(`Process: OK [${Quasar.format.humanStorageSize(t.length)}]> [Clipboard]`)})).catch((e=>{Quasar.Notify.create("Clipboard copy error."),ok=!1})):core.log("[DiaCreateImage4]Result, not string:",t)}catch(i){Quasar.Notify.create("Failed: "+i.message),console.log(i)}},dataSize:l}}},w={class:"column no-wrap full-height"},k={class:"col scroll"},S={class:"c-item"},z=u("div",{class:"caption"},"Size",-1),j={class:"value"},P={class:"c-item"},D=u("div",{class:"caption"},"Data Size",-1),O={class:"value"},T={class:"panel"},N={class:"widget-footer col-auto row no-wrap q-gutter-x-xs"},x=d("Process");var E=b(h,[["render",function(e,a,t,o,i,r){const b=c("q-select"),I=c("btn0"),h=c("picker0"),E=c("IDialog0"),Q=s("close-popup");return m(),n(E,{item:t.item,"btn-close":"",scroll:!1},{header:l((()=>[d(p(o.i.incomingImage),1)])),default:l((()=>[u("div",w,[u("div",k,[u("canvas",{style:g(o.canvasStyle),ref:e=>o.state.canvas=e},null,4),u("div",S,[z,u("div",j,p(o.state.imageSize[0])+" x "+p(o.state.imageSize[1]),1)]),u("div",P,[D,u("div",O,p(o.dataSize),1)]),t.item.diaCreateImage4.incoming?(m(),v("div",{key:0,class:"incomingImage",style:g({background:`url(${t.item.diaCreateImage4.incoming}) no-repeat center center / contain`,width:"100%",height:"240px"})},null,4)):f("",!0),u("div",T,[y(b,{options:o.targetOptions,modelValue:t.item.diaCreateImage4.target,"onUpdate:modelValue":a[0]||(a[0]=e=>t.item.diaCreateImage4.target=e),"map-options":"","emit-value":"",label:o.i.importTarget,dark:"",outlined:""},null,8,["options","modelValue","label"])])]),u("footer",N,[y(I,{tier:"proto",onClick:o.doCreate},{default:l((()=>[d(p(o.i.create),1)])),_:1},8,["onClick"]),y(I,{tier:"poormans",onClick:t.item.diaCreateImage4.copyBase64},{default:l((()=>[d(p(o.i.copyBase64),1)])),_:1},8,["onClick"]),C(y(I,{tier:"poormans"},{default:l((()=>[d(p(o.i.close),1)])),_:1},512),[[Q]]),y(h,{query:"v.type == 'Code1'",nameEP:"code1.name",tier:"poormans",orderBy:"fav0.fav code1.name",onPick:o.pickProcess},{default:l((()=>[d(p(o.state.processPickerTitle),1)])),_:1},8,["onPick"]),y(I,{tier:"epic",onClick:o.process},{default:l((()=>[x])),_:1},8,["onClick"])])])])),_:1},8,["item"])}]]);export{E as default};
